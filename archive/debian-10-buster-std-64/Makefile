

BASEDIR:=$(shell dab basedir)

all: info/init_ok
	dab bootstrap
	sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin yes/' ${BASEDIR}/etc/ssh/sshd_config
#	# As virtual package default-dbus-session-bus missing
#	# https://forums.debian.net/viewtopic.php?t=154000
	dab install dbus-x11 dbus-user-session zip unzip mlocate
	install -m 0755 genssh.sh ${BASEDIR}/root/genssh.sh
	unzip buster-sec-archives.zip -d ${BASEDIR}/var/cache/apt/
	echo "" >> ${BASEDIR}/etc/apt/sources.list
	echo "deb http://security.debian.org/debian-security buster/updates main contrib" >> ${BASEDIR}/etc/apt/sources.list
	echo "" >> ${BASEDIR}/etc/apt/sources.list
#	dab install /var/cache/apt/archives/xxd_2%3a8.1.0875-5+deb10u6_amd64.deb
#	dab exec dpkg -i /var/cache/apt/archives/
	dab exec dpkg -i /var/cache/apt/archives/base-files_10.3+deb10u13_amd64.deb /var/cache/apt/archives/bind9-host_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/bsdutils_1%3a2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/bzip2_1.0.6-9.2~deb10u2_amd64.deb /var/cache/apt/archives/cpio_2.12+dfsg-9+deb10u1_amd64.deb /var/cache/apt/archives/dbus-user-session_1.12.28-0+deb10u1_amd64.deb /var/cache/apt/archives/dbus-x11_1.12.28-0+deb10u1_amd64.deb /var/cache/apt/archives/dbus_1.12.28-0+deb10u1_amd64.deb /var/cache/apt/archives/debian-archive-keyring_2019.1+deb10u2_all.deb /var/cache/apt/archives/fdisk_2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/isc-dhcp-client_4.4.1-2+deb10u3_amd64.deb /var/cache/apt/archives/isc-dhcp-common_4.4.1-2+deb10u3_amd64.deb /var/cache/apt/archives/krb5-locales_1.17-3+deb10u6_all.deb /var/cache/apt/archives/less_487-0.1+deb10u1_amd64.deb /var/cache/apt/archives/libbind9-161_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/libblkid1_2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/libbz2-1.0_1.0.6-9.2~deb10u2_amd64.deb /var/cache/apt/archives/libc-bin_2.28-10+deb10u4_amd64.deb /var/cache/apt/archives/libc-l10n_2.28-10+deb10u4_all.deb /var/cache/apt/archives/libc6_2.28-10+deb10u4_amd64.deb /var/cache/apt/archives/libcurl3-gnutls_7.64.0-4+deb10u9_amd64.deb /var/cache/apt/archives/libdbus-1-3_1.12.28-0+deb10u1_amd64.deb /var/cache/apt/archives/libdns-export1104_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/libdns1104_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/libelf1_0.176-1.1+deb10u1_amd64.deb /var/cache/apt/archives/libexpat1_2.2.6-2+deb10u7_amd64.deb /var/cache/apt/archives/libfastjson4_0.99.8-2+deb10u1_amd64.deb /var/cache/apt/archives/libfdisk1_2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/libgnutls30_3.6.7-4+deb10u12_amd64.deb /var/cache/apt/archives/libgssapi-krb5-2_1.17-3+deb10u6_amd64.deb /var/cache/apt/archives/libisc-export1100_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/libisc1100_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/libisccc161_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/libisccfg163_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/libk5crypto3_1.17-3+deb10u6_amd64.deb /var/cache/apt/archives/libkrb5-3_1.17-3+deb10u6_amd64.deb /var/cache/apt/archives/libkrb5support0_1.17-3+deb10u6_amd64.deb /var/cache/apt/archives/liblwres161_1%3a9.11.5.P4+dfsg-5.1+deb10u11_amd64.deb /var/cache/apt/archives/libmount1_2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/libncurses6_6.1+20181013-2+deb10u5_amd64.deb /var/cache/apt/archives/libncursesw6_6.1+20181013-2+deb10u5_amd64.deb /var/cache/apt/archives/libnghttp2-14_1.36.0-2+deb10u3_amd64.deb /var/cache/apt/archives/libnss-systemd_241-7~deb10u10_amd64.deb /var/cache/apt/archives/libpam-systemd_241-7~deb10u10_amd64.deb /var/cache/apt/archives/libpcre2-8-0_10.32-5+deb10u1_amd64.deb /var/cache/apt/archives/libpython2.7-minimal_2.7.16-2+deb10u4_amd64.deb /var/cache/apt/archives/libpython2.7-stdlib_2.7.16-2+deb10u4_amd64.deb /var/cache/apt/archives/libpython3.7-minimal_3.7.3-2+deb10u7_amd64.deb /var/cache/apt/archives/libpython3.7-stdlib_3.7.3-2+deb10u7_amd64.deb /var/cache/apt/archives/libsmartcols1_2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/libsqlite3-0_3.27.2-3+deb10u2_amd64.deb /var/cache/apt/archives/libssh2-1_1.8.0-2.1+deb10u1_amd64.deb /var/cache/apt/archives/libssl1.1_1.1.1n-0+deb10u6_amd64.deb /var/cache/apt/archives/libsystemd0_241-7~deb10u10_amd64.deb /var/cache/apt/archives/libtasn1-6_4.13-3+deb10u1_amd64.deb /var/cache/apt/archives/libtinfo6_6.1+20181013-2+deb10u5_amd64.deb /var/cache/apt/archives/libudev1_241-7~deb10u10_amd64.deb /var/cache/apt/archives/libuuid1_2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/libx11-6_2%3a1.6.7-1+deb10u4_amd64.deb /var/cache/apt/archives/libx11-data_2%3a1.6.7-1+deb10u4_all.deb /var/cache/apt/archives/libxml2_2.9.4+dfsg1-7+deb10u6_amd64.deb /var/cache/apt/archives/locales_2.28-10+deb10u4_all.deb /var/cache/apt/archives/man-db_2.8.5-2+deb10u1_amd64.deb /var/cache/apt/archives/mount_2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/nano_3.2-3+deb10u1_amd64.deb /var/cache/apt/archives/ncurses-base_6.1+20181013-2+deb10u5_all.deb /var/cache/apt/archives/ncurses-bin_6.1+20181013-2+deb10u5_amd64.deb /var/cache/apt/archives/ncurses-term_6.1+20181013-2+deb10u5_all.deb /var/cache/apt/archives/openssh-client_1%3a7.9p1-10+deb10u4_amd64.deb /var/cache/apt/archives/openssh-server_1%3a7.9p1-10+deb10u4_amd64.deb /var/cache/apt/archives/openssh-sftp-server_1%3a7.9p1-10+deb10u4_amd64.deb /var/cache/apt/archives/openssl_1.1.1n-0+deb10u6_amd64.deb /var/cache/apt/archives/postfix_3.4.23-0+deb10u2_amd64.deb /var/cache/apt/archives/python2.7-minimal_2.7.16-2+deb10u4_amd64.deb /var/cache/apt/archives/python2.7_2.7.16-2+deb10u4_amd64.deb /var/cache/apt/archives/python3-idna_2.6-1+deb10u1_all.deb /var/cache/apt/archives/python3-reportbug_7.5.3~deb10u2_all.deb /var/cache/apt/archives/python3-requests_2.21.0-1+deb10u1_all.deb /var/cache/apt/archives/python3-urllib3_1.24.1-1+deb10u2_all.deb /var/cache/apt/archives/python3.7-minimal_3.7.3-2+deb10u7_amd64.deb /var/cache/apt/archives/python3.7_3.7.3-2+deb10u7_amd64.deb /var/cache/apt/archives/reportbug_7.5.3~deb10u2_all.deb /var/cache/apt/archives/ssh_1%3a7.9p1-10+deb10u4_all.deb /var/cache/apt/archives/systemd-sysv_241-7~deb10u10_amd64.deb /var/cache/apt/archives/systemd_241-7~deb10u10_amd64.deb /var/cache/apt/archives/tar_1.30+dfsg-6+deb10u1_amd64.deb /var/cache/apt/archives/tzdata_2024a-0+deb10u1_all.deb /var/cache/apt/archives/udev_241-7~deb10u10_amd64.deb /var/cache/apt/archives/util-linux_2.33.1-0.1+deb10u1_amd64.deb /var/cache/apt/archives/vim-common_2%3a8.1.0875-5+deb10u6_all.deb /var/cache/apt/archives/vim-tiny_2%3a8.1.0875-5+deb10u6_amd64.deb /var/cache/apt/archives/xxd_2%3a8.1.0875-5+deb10u6_amd64.deb /var/cache/apt/archives/zlib1g_1%3a1.2.11.dfsg-1+deb10u2_amd64.deb /var/cache/apt/archives/unzip_6.0-23+deb10u3_amd64.deb
	dab exec updatedb
	dab finalize

info/init_ok: dab.conf
	dab init
	touch $@

.PHONY: clean
clean:
	dab clean
	rm -f *~

.PHONY: dist-clean
dist-clean:
	dab dist-clean
	rm -f *~
